<UserControl x:Class="EasySave.WPF.Views.JobsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:EasySave.WPF.Views"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="900">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition/>
        </Grid.RowDefinitions>

        <!-- Top buttons -->
        <StackPanel Orientation="Horizontal"
                    Margin="0,0,0,10"
                    Grid.Row="0">

            <Button Content="{Binding AddJobText}"
                    Width="100"
                    Margin="5"
                    Style="{StaticResource ActionButtonStyle}"
                    Command="{Binding AddJobCommand}"/>

            <Button Content="{Binding ExecuteAllText}"
                    Width="120"
                    Margin="5"
                    Style="{StaticResource ActionButtonStyle}"
                    Command="{Binding ExecuteAllCommand}"/>

            <Button Content="{Binding ExecuteSelectedText}"
                    Width="140"
                    Margin="5"
                    Style="{StaticResource ActionButtonStyle}"
                    Command="{Binding ExecuteSelectedCommand}"/>

            <Button Content="{Binding StopJobText}"
                    Width="100"
                    Margin="5"
                    Style="{StaticResource DangerButtonStyle}"
                    Command="{Binding StopBackupCommand}"
                    Visibility="{Binding IsBackupRunning, Converter={StaticResource BooleanToVisibilityConverter}}"/>
        </StackPanel>

        <!-- Jobs DataGrid -->
        <DataGrid Grid.Row="1"
                  ItemsSource="{Binding Jobs}"
                  SelectedItem="{Binding SelectedJob}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  SelectionMode="Single"
                  IsReadOnly="True"
                  GridLinesVisibility="Horizontal"
                  HeadersVisibility="Column"
                  AlternatingRowBackground="#F5F5F5">

            <DataGrid.Columns>
                <!-- Checkbox for selection -->
                <DataGridTemplateColumn Width="40">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <CheckBox IsChecked="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged}"
                                      HorizontalAlignment="Center"
                                      VerticalAlignment="Center"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- Name column -->
                <DataGridTextColumn Header="{Binding DataContext.NameHeader, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                    Binding="{Binding Name}"
                                    Width="*"/>

                <!-- Source column -->
                <DataGridTextColumn Header="{Binding DataContext.SourceHeader, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                    Binding="{Binding SourcePath}"
                                    Width="2*"/>

                <!-- Target column -->
                <DataGridTextColumn Header="{Binding DataContext.TargetHeader, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                    Binding="{Binding TargetPath}"
                                    Width="2*"/>

                <!-- Type column -->
                <DataGridTextColumn Header="{Binding DataContext.TypeHeader, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                    Binding="{Binding TypeDisplay}"
                                    Width="*"/>

                <!-- Actions column -->
                <DataGridTemplateColumn Header="{Binding DataContext.ActionsHeader, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        Width="160">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <Button Content="{Binding DataContext.EditText, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        Width="60"
                                        Margin="2"
                                        Style="{StaticResource ActionButtonStyle}"
                                        Command="{Binding DataContext.EditJobCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}"/>
                                <Button Content="{Binding DataContext.DeleteText, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        Width="70"
                                        Margin="2"
                                        Style="{StaticResource DangerButtonStyle}"
                                        Command="{Binding DataContext.DeleteJobCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}"/>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Add/Edit Dialog Overlay -->
        <Grid Grid.RowSpan="2"
              Visibility="{Binding IsDialogOpen, Converter={StaticResource BooleanToVisibilityConverter}}">

            <!-- Semi-transparent background -->
            <Border Background="#80000000"/>

            <!-- Dialog box -->
            <Border Background="White"
                    CornerRadius="8"
                    Padding="30"
                    Width="500"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center">

                <StackPanel>
                    <TextBlock Text="{Binding AddJobText}"
                               FontSize="20"
                               FontWeight="Bold"
                               Margin="0,0,0,20"/>

                    <!-- Job Name -->
                    <TextBlock Text="{Binding NameHeader}" Margin="0,0,0,5"/>
                    <TextBox Text="{Binding DialogJobName, UpdateSourceTrigger=PropertyChanged}"
                             Height="30"
                             Margin="0,0,0,15"
                             Padding="5"/>

                    <!-- Source Path -->
                    <TextBlock Text="{Binding SourceHeader}" Margin="0,0,0,5"/>
                    <TextBox Text="{Binding DialogSourcePath, UpdateSourceTrigger=PropertyChanged}"
                             Height="30"
                             Margin="0,0,0,15"
                             Padding="5"/>

                    <!-- Target Path -->
                    <TextBlock Text="{Binding TargetHeader}" Margin="0,0,0,5"/>
                    <TextBox Text="{Binding DialogTargetPath, UpdateSourceTrigger=PropertyChanged}"
                             Height="30"
                             Margin="0,0,0,15"
                             Padding="5"/>

                    <!-- Type Selection -->
                    <TextBlock Text="{Binding TypeHeader}" Margin="0,0,0,5"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                        <RadioButton Content="Full"
                                     IsChecked="{Binding DialogType, Converter={StaticResource BackupTypeConverter}, ConverterParameter=full}"
                                     Margin="0,0,20,0"/>
                        <RadioButton Content="Differential"
                                     IsChecked="{Binding DialogType, Converter={StaticResource BackupTypeConverter}, ConverterParameter=diff}"/>
                    </StackPanel>

                    <!-- Buttons -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Content="Cancel"
                                Width="80"
                                Margin="0,0,10,0"
                                Style="{StaticResource TopBarButtonStyle}"
                                Command="{Binding CancelDialogCommand}"/>
                        <Button Content="Save"
                                Width="80"
                                Style="{StaticResource ActionButtonStyle}"
                                Command="{Binding SaveJobCommand}"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Stop Notification Popup (bottom-left) -->
        <Border Grid.RowSpan="2"
                VerticalAlignment="Bottom"
                HorizontalAlignment="Left"
                Background="#E74C3C"
                CornerRadius="5"
                Padding="15,10"
                Margin="10,0,0,10"
                Visibility="{Binding StopNotificationVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
            <TextBlock Text="{Binding StopNotificationText}"
                       Foreground="White"
                       FontWeight="Bold"
                       FontSize="14"/>
        </Border>
    </Grid>
</UserControl>
